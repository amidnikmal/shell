"use strict";(self["webpackChunkshell"]=self["webpackChunkshell"]||[]).push([[139],{3139:function(s,t,e){e.r(t),e.d(t,{Binance:function(){return o}});var n=e(5564),i=e.n(n),h=e(9646);const o={apiUrl:"https://www.binance.com/api/v3",apiKey:"",apiSecret:"",wssconnection:null,eventsBuffer:[],events:[],cb:null,symbol:"BNBBTC",changeSymbol(s){return this.symbol=s,this.eventsBuffer=[],this.events=[],this.startFetchData(this.symbol)},on(s,t){this.cb=t},getSymbols(){return Promise.resolve(h.BinanceSymbolsResponse)},getMarketDepth({symbol:s,limit:t}){return i().get(`${this.apiUrl}/depth?symbol=${this.symbol?this.symbol:s}&limit=${t}`)},wssConnect(){this.wssconnection=new WebSocket("wss://stream.binance.com/stream"),this.wssSubscribe()},wssSubscribe(){this.wssconnection.addEventListener("open",(()=>{this.wssconnection.onmessage=s=>{const t=JSON.parse(s.data);if(t.stream==this.symbol.toLowerCase()+"@depth"){if(this.eventsBuffer.push(t),this.depthSnapshot&&0===this.events.length){const{lastUpdateId:s}=this.depthSnapshot,[t]=this.eventsBuffer.filter((t=>{const{U:e,u:n}=t.data;return e<=s+1&&n>=s+1}));t&&(this.events.push(t),this.cb(t),this.eventsBuffer=[])}if(this.events.length>0){const s=this.events.length-1,t=this.events[s],{u:e}=t.data,[n]=this.eventsBuffer.filter((s=>{const{U:t}=s.data;return t===e+1}));n&&(this.events.push(n),this.cb(n),this.eventsBuffer=[])}}};const s={method:"SUBSCRIBE",params:["!miniTicker@arr@3000ms",this.symbol.toLowerCase()+"@aggTrade",this.symbol.toLowerCase()+"@kline_1d",this.symbol.toLowerCase()+"@depth"],id:1};this.wssconnection.send(JSON.stringify(s))}))},async startFetchData(s){return this.wssConnect(),new Promise((t=>{setTimeout((async()=>{const{data:e}=await this.getMarketDepth({symbol:s,limit:500});this.depthSnapshot=e,t(e)}),3e3)}))}}}}]);
//# sourceMappingURL=139.4b88c45f.js.map